# HTTP - always available on port 80, any hostname
:80 {
    handle_path /api/* {
        reverse_proxy backend:8989
    }
    handle {
        reverse_proxy frontend:3000 {
            # FIX 4: Prevent Redirect Loop via Cloudflare/Traefik
            header_up X-Forwarded-Proto https
        }
    }
}

# === HTTPS SETUP ===
# To enable HTTPS, uncomment below and replace example.com with your domain:
#
# example.com {
#     handle /api/* {
#         reverse_proxy backend:8989
#     }
#     handle /webhook* {
#         reverse_proxy backend:8989
#     }
#     handle {
#         reverse_proxy frontend:3000
#     }
# }
